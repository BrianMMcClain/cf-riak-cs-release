name: cf-riak-cs
director_uuid: (( merge ))

resource_pools: (( merge ))
networks: (( merge ))
jobs: (( merge ))

releases:
- name: cf-riak-cs
  version: latest

compilation:
  workers: 2
  network: riak-cs-network
  reuse_compilation_vms: true
  cloud_properties: (( resource_pools.[0].cloud_properties ))

update:
  canaries: 1
  canary_watch_time: 30000-240000
  update_watch_time: 30000-600000
  max_in_flight: 3

properties:
  cf: (( merge || nil ))
  riak:
    firewall_enabled: (( merge ))
    seed_node: (( jobs.[0].networks.[0].static_ips.[0] ))
    ips: (( jobs.[0].networks.[0].static_ips ))
  riak_cs:
    admin_key: "admin-key"
    admin_secret: "admin-secret"
    ips: (( properties.riak.ips ))
    ssl_enabled: (( merge || true ))
    skip_ssl_validation: (( merge || false ))
    register_route: (( merge || true ))
  stanchion:
    ip: (( jobs.[1].networks.[0].static_ips.[0] ))
  broker:
    name: p-blobstore
    host: (( properties.external_broker_host ))
    port: 80
    username: admin
    password: admin
  networks:
    riak_cs_network: riak-cs-network
  nats: (( merge ))
  domain : (( merge || "example.com" ))
  external_riakcs_host: (( "riakcs." properties.domain ))
  external_broker_host: (( "p-cs." properties.domain ))
  catalog:
    services:
    - bindable: true
      description: An S3-compatible open source storage built on top of Riak.
      id: 33d2eeb0-0236-4c83-b494-da3faeb5b2e8
      metadata:
        displayName: Riak CS Storage
        documentationUrl: https://github.com/cloudfoundry/cf-riak-cs-broker
        imageUrl: http://www.linux.com/news/galleries/image/riak-cs%3Fformat%3Dimage%26thumbnail%3Dsmall
        longDescription: Provisioning the service creates a Riak CS bucket. Binding an
          application creates unique credentials for that application to access the bucket.
        providerDisplayName: Riak CS
        supportUrl: https://github.com/cloudfoundry/cf-riak-cs-broker/issues
      name: riak-cs
      plans:
      - description: A bucket on Riak CS.
        id: 946ce484-376b-41b4-8c4e-4bc830676115
        metadata:
          bullets:
          - Buckets are private
          costs:
          - amount:
              usd: 0.0
            unit: MONTHLY
          displayName: Bucket
        name: bucket
      tags:
      - blobstore
